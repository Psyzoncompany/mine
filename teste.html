<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê∑ Porquinho 3D Animado</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #7dd3fc;
            font-family: sans-serif;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
            cursor: grab;
        }

        canvas:active {
            cursor: grabbing;
        }

        #instrucoes {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: #0f172a;
            font-size: 1.2rem;
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
        }

        #painel {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }

        button {
            background: #fdf2f8;
            color: #9d174d;
            border: 2px solid #fbcfe8;
            padding: 12px 20px;
            margin: 0 5px;
            font-size: 1.1rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            pointer-events: auto;
            transition: 0.2s;
            box-shadow: 0 4px 0 #f472b6;
        }

        button:hover {
            background: #fce7f3;
            transform: scale(1.05);
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        #btn-dano {
            background: #fee2e2;
            color: #b91c1c;
            border-color: #fecaca;
            box-shadow: 0 4px 0 #f87171;
        }

        #btn-morte {
            background: #1e293b;
            color: #f8fafc;
            border-color: #334155;
            box-shadow: 0 4px 0 #0f172a;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>

<body>

    <div id="instrucoes">üëÜ Arraste para girar | Rodinha para Zoom üê∑üå±</div>

    <div id="painel">
        <button onclick="mudarEstado('andar')">üêæ Andar</button>
        <button id="btn-dano" onclick="mudarEstado('dano')">üí• Levar Dano</button>
        <button id="btn-morte" onclick="mudarEstado('morrer')">üíÄ Morrer</button>
        <button onclick="mudarEstado('parado')">üêΩ Respirar (Parado)</button>
    </div>

    <script>
        window.estadoAcao = 'parado';
        window.tempoAcao = 0;
        const materiaisDano = [];

        // üïπÔ∏è CONTROLE DE ESTADOS
        window.mudarEstado = function (acao) {
            if (window.estadoAcao === 'morrer' && acao !== 'parado') return;
            window.estadoAcao = acao;
            window.tempoAcao = 0;
            materiaisDano.forEach(mat => mat.emissive?.setHex(0x000000));
        };

        window.onload = function () {
            // üåç CENA E C√ÇMERA
            const scene = new THREE.Scene();
            scene.background = new THREE.Color('#7dd3fc'); // C√©u azul
            scene.fog = new THREE.Fog('#7dd3fc', 10, 30);

            const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(8, 5, 10);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(0, 1.5, 0);
            controls.update();

            // üí° ILUMINA√á√ÉO DE FAZENDA
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const luzSol = new THREE.DirectionalLight(0xffffff, 1.0);
            luzSol.position.set(5, 10, 5);
            luzSol.castShadow = true;
            scene.add(luzSol);

            // üé® TEXTURAS PROCEDURAIS (Pele de porco com pintinhas)
            const criarTex = (c1, c2, n) => {
                const c = document.createElement('canvas'); c.width = 32; c.height = 32;
                const ctx = c.getContext('2d');
                ctx.fillStyle = c1; ctx.fillRect(0, 0, 32, 32);
                ctx.fillStyle = c2;
                for (let i = 0; i < n; i++) {
                    ctx.beginPath();
                    ctx.arc(Math.random() * 32, Math.random() * 32, Math.random() * 2, 0, Math.PI * 2);
                    ctx.fill();
                }
                const t = new THREE.CanvasTexture(c);
                t.magFilter = t.minFilter = THREE.NearestFilter;
                return t;
            };

            // üß± MATERIAIS
            const matPele = new THREE.MeshStandardMaterial({ map: criarTex('#fbcfe8', '#f472b6', 15), roughness: 0.8 });
            const matFocinho = new THREE.MeshStandardMaterial({ color: '#db2777', roughness: 0.6 });
            const matCasco = new THREE.MeshStandardMaterial({ color: '#334155', roughness: 0.9 });
            const matOlho = new THREE.MeshStandardMaterial({ color: '#0f172a' });

            materiaisDano.push(matPele, matFocinho);

            // üê∑ MODELAGEM DO PORCO
            const porco = new THREE.Group();

            // CORPO
            const corpoGrupo = new THREE.Group();
            corpoGrupo.position.y = 1.6;
            const corpo = new THREE.Mesh(new THREE.BoxGeometry(1.6, 1.4, 2.4), matPele);
            corpo.castShadow = true;
            corpoGrupo.add(corpo);

            // RABINHO
            const rabo = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.4, 0.2), matPele);
            rabo.position.set(0, 0.2, -1.3);
            rabo.rotation.x = -Math.PI / 4;
            corpoGrupo.add(rabo);
            porco.add(corpoGrupo);

            // CABE√áA
            const cabecaGrupo = new THREE.Group();
            cabecaGrupo.position.set(0, 1.8, 1.3);

            const cabecaBase = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.0), matPele);
            cabecaGrupo.add(cabecaBase);

            // FOCINHO
            const focinho = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.5, 0.4), matFocinho);
            focinho.position.set(0, -0.1, 0.6);
            cabecaGrupo.add(focinho);

            // ORELHAS
            const orelhaE = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.5, 0.2), matPele);
            orelhaE.position.set(0.5, 0.7, 0); orelhaE.rotation.z = -0.3; orelhaE.rotation.x = 0.2;
            const orelhaD = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.5, 0.2), matPele);
            orelhaD.position.set(-0.5, 0.7, 0); orelhaD.rotation.z = 0.3; orelhaD.rotation.x = 0.2;
            cabecaGrupo.add(orelhaE, orelhaD);

            // OLHOS
            const olhoE = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.15, 0.1), matOlho);
            olhoE.position.set(0.35, 0.3, 0.51);
            const olhoD = olhoE.clone(); olhoD.position.x = -0.35;
            cabecaGrupo.add(olhoE, olhoD);

            porco.add(cabecaGrupo);

            // PERNAS (Piv√¥ no topo para girar certo)
            const criarPerna = (x, z) => {
                const g = new THREE.Group();
                g.position.set(x, 1.0, z);
                const perna = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.8, 0.4), matPele);
                perna.position.y = -0.4;
                const casco = new THREE.Mesh(new THREE.BoxGeometry(0.45, 0.2, 0.45), matCasco);
                casco.position.y = -0.9;
                g.add(perna, casco);
                return g;
            };

            const pernaFE = criarPerna(0.5, 0.8);  // Frente Esquerda
            const pernaFD = criarPerna(-0.5, 0.8); // Frente Direita
            const pernaTE = criarPerna(0.5, -0.8); // Tr√°s Esquerda
            const pernaTD = criarPerna(-0.5, -0.8);// Tr√°s Direita
            porco.add(pernaFE, pernaFD, pernaTE, pernaTD);

            scene.add(porco);

            // üå± CH√ÉO (Grama)
            const matGrama = new THREE.MeshStandardMaterial({ color: '#4ade80', roughness: 1 });
            const chao = new THREE.Mesh(new THREE.PlaneGeometry(50, 50), matGrama);
            chao.rotation.x = -Math.PI / 2; chao.receiveShadow = true;
            scene.add(chao);

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // üîÑ LOOP DE ANIMA√á√ÉO
            function animar() {
                requestAnimationFrame(animar);
                controls.update();
                tempoGlobal += 0.05; window.tempoAcao += 0.05;
                const t = window.tempoAcao;
                const l = THREE.MathUtils.lerp;

                // üßπ RESET SUAVE DAS POSI√á√ïES
                porco.rotation.z = l(porco.rotation.z, 0, 0.1);
                porco.rotation.x = l(porco.rotation.x, 0, 0.1);
                porco.position.set(0, l(porco.position.y, 0, 0.1), l(porco.position.z, 0, 0.1));
                cabecaGrupo.rotation.x = l(cabecaGrupo.rotation.x, 0, 0.1);
                cabecaGrupo.rotation.y = l(cabecaGrupo.rotation.y, 0, 0.1);
                pernaFE.rotation.x = l(pernaFE.rotation.x, 0, 0.1);
                pernaFD.rotation.x = l(pernaFD.rotation.x, 0, 0.1);
                pernaTE.rotation.x = l(pernaTE.rotation.x, 0, 0.1);
                pernaTD.rotation.x = l(pernaTD.rotation.x, 0, 0.1);
                corpoGrupo.scale.set(1, 1, 1);

                // üé¨ ESTADOS DE ANIMA√á√ÉO
                if (window.estadoAcao === 'andar') {
                    const s = Math.sin(t * 8); // Velocidade do passo
                    // Movimento cruzado das pernas
                    pernaFE.rotation.x = s * 0.6;
                    pernaTD.rotation.x = s * 0.6;
                    pernaFD.rotation.x = -s * 0.6;
                    pernaTE.rotation.x = -s * 0.6;
                    // Pulo do corpo
                    porco.position.y = Math.abs(s) * 0.2;
                    cabecaGrupo.rotation.x = Math.sin(t * 8) * 0.1;

                } else if (window.estadoAcao === 'dano') {
                    if (t < 0.4) {
                        porco.position.z = -0.5; // Empurr√£o pra tr√°s
                        porco.rotation.x = -0.2; // Levanta a frente
                        cabecaGrupo.rotation.x = -0.3;
                        // Pisca vermelho
                        materiaisDano.forEach(m => m.emissive?.setHex(t * 15 % 2 < 1 ? 0xff0000 : 0));
                    } else {
                        window.mudarEstado('parado');
                    }

                } else if (window.estadoAcao === 'morrer') {
                    // Cai de lado, pernas duras
                    porco.rotation.z = l(porco.rotation.z, Math.PI / 2, 0.05);
                    porco.position.y = l(porco.position.y, -0.6, 0.05);
                    pernaFE.rotation.x = l(pernaFE.rotation.x, 0.5, 0.05);
                    pernaFD.rotation.x = l(pernaFD.rotation.x, 0.5, 0.05);
                    pernaTE.rotation.x = l(pernaTE.rotation.x, 0.5, 0.05);
                    pernaTD.rotation.x = l(pernaTD.rotation.x, 0.5, 0.05);

                } else {
                    // üêΩ RESPIRA√á√ÉO (Parado)
                    // Barriga inflando e desinflando
                    const respiro = Math.sin(tempoGlobal * 3);
                    corpoGrupo.scale.set(1 + respiro * 0.03, 1 + respiro * 0.05, 1);
                    // Cabe√ßa mexendo suavemente
                    cabecaGrupo.rotation.x = respiro * 0.05;
                    // Rabinho balan√ßando devagar
                    rabo.rotation.z = Math.sin(tempoGlobal * 5) * 0.2;
                }

                renderer.render(scene, camera);
            }

            let tempoGlobal = 0;
            animar();
        };
    </script>
</body>

</html>